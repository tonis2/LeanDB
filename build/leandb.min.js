!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).leandb=t()}(this,function(){"use strict";class e{constructor(e,t,s){return this.createTransaction(e,t,s)}async createTransaction(e,t,s){const n=await e,r=await n.transaction(t,s);return await r.objectStore(t)}}class t{constructor(e,t,s){this.name=e,this.version=t,this.db=s}async add(t){return new Promise(async(s,n)=>{let r=(await new e(this.db,this.name,"readwrite")).put(t);r.onerror=(e=>{n(e)}),r.onsuccess=(e=>{s(e.target.result)})})}delete(t){return new Promise(async s=>{(await new e(this.db,this.name,"readwrite")).openCursor().onsuccess=(e=>{const n=e.target.result;if(n){Object.keys(t).map(e=>Object.is(n.value[e],t[e])).filter(e=>!e).length<1&&n.delete(),n.continue()}else s()})})}update(t){return this.value=(s=>new Promise(async n=>{(await new e(this.db,this.name,"readwrite")).openCursor().onsuccess=(e=>{const r=e.target.result;if(r){Object.keys(t).map(e=>Object.is(r.value[e],t[e])).filter(e=>!e).length<1&&r.update(Object.assign(r.value,s)),r.continue()}else n()})})),this}async find(t){return new Promise(async(s,n)=>{const r=(await new e(this.db,this.name,"readwrite")).openCursor(),a=[];r.onsuccess=(e=>{const n=e.target.result;if(n){Object.keys(t).map(e=>Object.is(n.value[e],t[e])).filter(e=>!e).length<1&&a.push(n.value),n.continue()}else s(a)}),r.onerror=(e=>{n(`Failed to apply search in ${this.name}`)})})}}class s{constructor(e,t,s){return this.name=e,this.version=t,this.start_database(s)}start_database(e){const t=indexedDB.open(this.name,this.version||1);return new Promise((s,n)=>{t.onsuccess=(e=>s(e.target.result)),t.onerror=(e=>n(e.target.result)),e&&(t.onupgradeneeded=(t=>{e(t.target.result)}))})}}return class{constructor(e){this.name=e}async init(e,n){const r=new s(this.name,this.version,e=>{Object.entries(n).forEach(async t=>{const s=t[0],n=t[1].split(",");let r=await e.createObjectStore(s,{autoIncrement:!0});n.forEach(e=>r.createIndex(e,e,{unique:!1}))})});return Object.keys(n).forEach(s=>this[s]=new t(s,e,r)),this}}});
